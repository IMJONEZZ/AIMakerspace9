{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.4"
  },
  "cells": [
    {
      "id": "Hbol",
      "code_hash": "8fb74e14919f3985158f12b149b9cfaf",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"your-first-rag-application-personal-wellness-assistant\">Your First RAG Application: Personal Wellness Assistant</h1>\n<span class=\"paragraph\">In this notebook, we'll walk you through each of the components that are involved in a simple RAG application by building a <strong>Personal Wellness Assistant</strong>.</span>\n<span class=\"paragraph\">Imagine having an AI assistant that can answer your health and wellness questions based on a curated knowledge base - that's exactly what we'll build here. We won't be leveraging any fancy tools, just the OpenAI Python SDK, Numpy, and some classic Python.</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: This was done with Python 3.12.3.</span>\n<span class=\"paragraph\">NOTE: There might be <a href=\"https://github.com/wandb/wandb/issues/7683\" rel=\"noopener noreferrer\" target=\"_blank\">compatibility issues</a> if you're on NVIDIA driver &gt;552.44 As an interim solution - you can rollback your drivers to the 552.44.</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "92ddc4de867ad3c43ab17ca628d69b84",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"table-of-contents\">Table of Contents:</h2>\n<ul>\n<li>Task 1: Imports and Utilities</li>\n<li>Task 2: Documents (Loading our Wellness Knowledge Base)</li>\n<li>Task 3: Embeddings and Vectors</li>\n<li>Task 4: Prompts</li>\n<li>\n<span class=\"paragraph\">Task 5: Retrieval Augmented Generation (Building the Wellness Assistant)</span>\n<ul>\n<li>\ud83d\udea7 Activity #1: Enhance Your Wellness Assistant</li>\n</ul>\n</li>\n</ul></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "552b5bc56f5a9ebe261b7edad7e11344",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Let's look at a rather complicated looking visual representation of a basic RAG application.</span>\n<span class=\"paragraph\"><img src=\"https://i.imgur.com/vD8b016.png\" /></span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "b42e968068fd26393452ed76cdb9c9d9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"task-1-imports-and-utilities\">Task 1: Imports and Utilities</h2>\n<span class=\"paragraph\">We're just doing some imports and enabling <code>async</code> to work within the Jupyter environment here, nothing too crazy!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "6aac1b8791305c023d169c56e15b1063",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"task-2-documents\">Task 2: Documents</h2>\n<span class=\"paragraph\">We'll be concerning ourselves with this part of the flow in the following section:</span>\n<span class=\"paragraph\"><img src=\"https://i.imgur.com/jTm9gjk.png\" /></span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "73b11cfa3ddc61c4f75e61684a9c6246",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"loading-source-documents\">Loading Source Documents</h3>\n<span class=\"paragraph\">So, first things first, we need some documents to work with.</span>\n<span class=\"paragraph\">While we could work directly with the <code>.txt</code> files (or whatever file-types you wanted to extend this to) we can instead do some batch processing of those documents at the beginning in order to store them in a more machine compatible format.</span>\n<span class=\"paragraph\">In this case, we're going to parse our text file into a single document in memory.</span>\n<span class=\"paragraph\">Let's look at the relevant bits of the <code>TextFileLoader</code> class:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">load_file</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s2\">&quot;r&quot;</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">documents</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">())</span>\n</code></pre></div>\n<span class=\"paragraph\">We're simply loading the document using the built in <code>open</code> method, and storing that output in our <code>self.documents</code> list.</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: We're using a comprehensive Health &amp; Wellness Guide as our sample data. This content covers exercise, nutrition, sleep, stress management, and healthy habits - perfect for building a personal wellness assistant!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": "4b5e2b68f3a8c38c783952603c56a3d1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"splitting-text-into-chunks\">Splitting Text Into Chunks</h3>\n<span class=\"paragraph\">As we can see, there is one massive document.</span>\n<span class=\"paragraph\">We'll want to chunk the document into smaller parts so it's easier to pass the most relevant snippets to the LLM.</span>\n<span class=\"paragraph\">There is no fixed way to split/chunk documents - and you'll need to rely on some intuition as well as knowing your data <em>very</em> well in order to build the most robust system.</span>\n<span class=\"paragraph\">For this toy example, we'll just split blindly on length.</span>\n<blockquote>\n<span class=\"paragraph\">There's an opportunity to clear up some terminology here, for this course we will stick to the following:</span>\n<ul>\n<li>\"source documents\" : The <code>.txt</code>, <code>.pdf</code>, <code>.html</code>, ..., files that make up the files and information we start with in its raw format</li>\n<li>\"document(s)\" : single (or more) text object(s)</li>\n<li>\"corpus\" : the combination of all of our documents</li>\n</ul>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "631b556ef8730bf09d5093c443be8f67",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">As you can imagine (though it's not specifically true in this toy example) the idea of splitting documents is to break them into manageable sized chunks that retain the most relevant local context.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "dcb1e37b824af14c9b8e58c11d465836",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Let's take a look at some of the documents we've managed to split.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ZHCJ",
      "code_hash": "3d3ddb7c2c3e4813ff4515b3cdfb63cc",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"task-3-embeddings-and-vectors\">Task 3: Embeddings and Vectors</h2>\n<span class=\"paragraph\">Next, we have to convert our corpus into a \"machine readable\" format as we explored in the Embedding Primer notebook.</span>\n<span class=\"paragraph\">Today, we're going to talk about the actual process of creating, and then storing, these embeddings, and how we can leverage that to intelligently add context to our queries.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ROlb",
      "code_hash": "a8d697093cfb7d163f5c231ce4f44685",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"openai-api-key\">OpenAI API Key</h3>\n<span class=\"paragraph\">In order to access OpenAI's APIs, we'll need to provide our OpenAI API Key!</span>\n<span class=\"paragraph\">You can work through the folder \"OpenAI API Key Setup\" for more information on this process if you don't already have an API Key!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "TqIu",
      "code_hash": "728264d591e80bfced83aa0e73b25b5e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"vector-database\">Vector Database</h3>\n<span class=\"paragraph\">Let's set up our vector database to hold all our documents and their embeddings!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Vxnm",
      "code_hash": "e2bce2b87e96b9e9954f55de0ec1f766",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">While this is all baked into 1 call - we can look at some of the code that powers this process to get a better understanding:</span>\n<span class=\"paragraph\">Let's look at our <code>VectorDatabase().__init__()</code>:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">embedding_model</span><span class=\"p\">:</span> <span class=\"n\">EmbeddingModel</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">vectors</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_model</span> <span class=\"o\">=</span> <span class=\"n\">embedding_model</span> <span class=\"ow\">or</span> <span class=\"n\">EmbeddingModel</span><span class=\"p\">()</span>\n</code></pre></div>\n<span class=\"paragraph\">As you can see - our vectors are merely stored as a dictionary of <code>np.array</code> objects.</span>\n<span class=\"paragraph\">Secondly, our <code>VectorDatabase()</code> has a default <code>EmbeddingModel()</code> which is a wrapper for OpenAI's <code>text-embedding-3-small</code> model.</span>\n<blockquote>\n<span class=\"paragraph\"><strong>Quick Info About <code>text-embedding-3-small</code></strong>:\n- It has a context window of <strong>8191</strong> tokens\n- It returns vectors with dimension <strong>1536</strong></span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "DnEU",
      "code_hash": "9f24ba1552388573a19c6afbc106f071",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h4 id=\"question-1\">\u2753Question #1:</h4>\n<span class=\"paragraph\">The default embedding dimension of <code>text-embedding-3-small</code> is 1536, as noted above.</span>\n<ol>\n<li>Is there any way to modify this dimension?</li>\n<li>What technique does OpenAI use to achieve this?</li>\n</ol>\n<blockquote>\n<span class=\"paragraph\">NOTE: Check out this <a href=\"https://platform.openai.com/docs/api-reference/embeddings/create\" rel=\"noopener noreferrer\" target=\"_blank\">API documentation</a> for the answer to question #1.1, and <a href=\"https://arxiv.org/abs/2205.13147\" rel=\"noopener noreferrer\" target=\"_blank\">this paper</a> for an answer to question #1.2!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ulZA",
      "code_hash": "68b9b7979a2d7fa7f758ecf1e76c5296",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"answer\">\u2705 Answer:</h5>\n<ol>\n<li>Yes,</li>\n</ol>\n<div class=\"language-text codehilite\"><pre><span></span><code>dimensions\ninteger\nOptional\nThe number of dimensions the resulting output embeddings should have. Only supported in text-embedding-3 and later models.\n</code></pre></div>\n<ol start=\"2\">\n<li>Matryoshka</li>\n</ol></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ecfG",
      "code_hash": "a162c269281415c7075deae8279e7ac2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">We can call the <code>async_get_embeddings</code> method of our <code>EmbeddingModel()</code> on a list of <code>str</code> and receive a list of <code>float</code> back!</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">async_get_embeddings</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">list_of_text</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">])</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">]]:</span>\n        <span class=\"k\">return</span> <span class=\"k\">await</span> <span class=\"n\">aget_embeddings</span><span class=\"p\">(</span>\n            <span class=\"n\">list_of_text</span><span class=\"o\">=</span><span class=\"n\">list_of_text</span><span class=\"p\">,</span> <span class=\"n\">engine</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embeddings_model_name</span>\n        <span class=\"p\">)</span>\n</code></pre></div></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Pvdt",
      "code_hash": "641ff1c52d4270cab9b0356f2d5ea19c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">We cast those to <code>np.array</code> when we build our <code>VectorDatabase()</code>:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">abuild_from_list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">list_of_text</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">])</span> <span class=\"o\">-&gt;</span> <span class=\"s2\">&quot;VectorDatabase&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">embeddings</span> <span class=\"o\">=</span> <span class=\"k\">await</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">embedding_model</span><span class=\"o\">.</span><span class=\"n\">async_get_embeddings</span><span class=\"p\">(</span><span class=\"n\">list_of_text</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">embedding</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">list_of_text</span><span class=\"p\">,</span> <span class=\"n\">embeddings</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"n\">embedding</span><span class=\"p\">))</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span>\n</code></pre></div>\n<span class=\"paragraph\">And that's all we need to do!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "aLJB",
      "code_hash": "b31ab24ea9fa6791fcf676e621a28b54",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h4 id=\"question-2\">\u2753Question #2:</h4>\n<span class=\"paragraph\">What are the benefits of using an <code>async</code> approach to collecting our embeddings?</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: Determining the core difference between <code>async</code> and <code>sync</code> will be useful! If you get stuck - ask ChatGPT!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "nHfw",
      "code_hash": "6381f493fd57057620452e24ea3a29df",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"answer-it-allows-us-to-wait-for-embeddings-to-be-returned-and-to-possibly-execute-other-non-dependent-code-while-were-waiting-instead-of-erroring-out-immediately\">\u2705 Answer: It allows us to wait for embeddings to be returned (and to possibly execute other non-dependent code while we're waiting) instead of erroring out immediately.</h5></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "xXTn",
      "code_hash": "022d917c386629e08549e299d71ae0f3",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">So, to review what we've done so far in natural language:</span>\n<ol>\n<li>We load source documents</li>\n<li>We split those source documents into smaller chunks (documents)</li>\n<li>We send each of those documents to the <code>text-embedding-3-small</code> OpenAI API endpoint</li>\n<li>We store each of the text representations with the vector representations as keys/values in a dictionary</li>\n</ol></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "AjVT",
      "code_hash": "eb060d3b95f3580eae4c692f7c54fd46",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"semantic-similarity\">Semantic Similarity</h3>\n<span class=\"paragraph\">The next step is to be able to query our <code>VectorDatabase()</code> with a <code>str</code> and have it return to us vectors and text that is most relevant from our corpus.</span>\n<span class=\"paragraph\">We're going to use the following process to achieve this in our toy example:</span>\n<ol>\n<li>We need to embed our query with the same <code>EmbeddingModel()</code> as we used to construct our <code>VectorDatabase()</code></li>\n<li>We loop through every vector in our <code>VectorDatabase()</code> and use a distance measure to compare how related they are</li>\n<li>We return a list of the top <code>k</code> closest vectors, with their text representations</li>\n</ol>\n<span class=\"paragraph\">There's some very heavy optimization that can be done at each of these steps - but let's just focus on the basic pattern in this notebook.</span>\n<blockquote>\n<span class=\"paragraph\">We are using <a href=\"https://www.engati.com/glossary/cosine-similarity\" rel=\"noopener noreferrer\" target=\"_blank\">cosine similarity</a> as a distance metric in this example - but there are many many distance metrics you could use - like <a href=\"https://flavien-vidal.medium.com/similarity-distances-for-natural-language-processing-16f63cd5ba55\" rel=\"noopener noreferrer\" target=\"_blank\">these</a></span>\n<span class=\"paragraph\">We are using a rather inefficient way of calculating relative distance between the query vector and all other vectors - there are more advanced approaches that are much more efficient, like <a href=\"https://towardsdatascience.com/comprehensive-guide-to-approximate-nearest-neighbors-algorithms-8b94f057d6b6\" rel=\"noopener noreferrer\" target=\"_blank\">ANN</a></span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "NCOB",
      "code_hash": "756a1970c5337d3ad3bf28c47a8b4f0b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"task-4-prompts\">Task 4: Prompts</h2>\n<span class=\"paragraph\">In the following section, we'll be looking at the role of prompts - and how they help us to guide our application in the right direction.</span>\n<span class=\"paragraph\">In this notebook, we're going to rely on the idea of \"zero-shot in-context learning\".</span>\n<span class=\"paragraph\">This is a lot of words to say: \"We will ask it to perform our desired task in the prompt, and provide no examples.\"</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "aqbW",
      "code_hash": "99fdfc504ca440f2922102da4a02dcc5",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"xyzroleprompt\">XYZRolePrompt</h3>\n<span class=\"paragraph\">Before we do that, let's stop and think a bit about how OpenAI's chat models work.</span>\n<span class=\"paragraph\">We know they have roles - as is indicated in the following API <a href=\"https://platform.openai.com/docs/api-reference/chat/create#chat/create-messages\" rel=\"noopener noreferrer\" target=\"_blank\">documentation</a></span>\n<span class=\"paragraph\">There are three roles, and they function as follows (taken directly from <a href=\"https://platform.openai.com/docs/guides/gpt/chat-completions-api\" rel=\"noopener noreferrer\" target=\"_blank\">OpenAI</a>):</span>\n<ul>\n<li><code>{\"role\" : \"system\"}</code> : The system message helps set the behavior of the assistant. For example, you can modify the personality of the assistant or provide specific instructions about how it should behave throughout the conversation. However note that the system message is optional and the model\u2019s behavior without a system message is likely to be similar to using a generic message such as \"You are a helpful assistant.\"</li>\n<li><code>{\"role\" : \"user\"}</code> : The user messages provide requests or comments for the assistant to respond to.</li>\n<li><code>{\"role\" : \"assistant\"}</code> : Assistant messages store previous assistant responses, but can also be written by you to give examples of desired behavior.</li>\n</ul>\n<span class=\"paragraph\">The main idea is this:</span>\n<ol>\n<li>You start with a system message that outlines how the LLM should respond, what kind of behaviours you can expect from it, and more</li>\n<li>Then, you can provide a few examples in the form of \"assistant\"/\"user\" pairs</li>\n<li>Then, you prompt the model with the true \"user\" message.</li>\n</ol>\n<span class=\"paragraph\">In this example, we'll be forgoing the 2nd step for simplicity's sake.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "TRpd",
      "code_hash": "7083a1bec15c26a81d7aacb4fc06a051",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h4 id=\"utility-functions\">Utility Functions</h4>\n<span class=\"paragraph\">You'll notice that we're using some utility functions from the <code>aimakerspace</code> module - let's take a peek at these and see what they're doing!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "TXez",
      "code_hash": "621e91f4785e7ee030646230776a8c4d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"xyzroleprompt\">XYZRolePrompt</h5></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "dNNg",
      "code_hash": "bb9f39303c1ed96139e5248d1d9b26eb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Here we have our <code>system</code>, <code>user</code>, and <code>assistant</code> role prompts.</span>\n<span class=\"paragraph\">Let's take a peek at what they look like:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">BasePrompt</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">prompt</span><span class=\"p\">):</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">Initializes</span> <span class=\"n\">the</span> <span class=\"n\">BasePrompt</span> <span class=\"nb\">object</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">prompt</span> <span class=\"n\">template</span><span class=\"o\">.</span>\n\n        <span class=\"p\">:</span><span class=\"n\">param</span> <span class=\"n\">prompt</span><span class=\"p\">:</span> <span class=\"n\">A</span> <span class=\"n\">string</span> <span class=\"n\">that</span> <span class=\"n\">can</span> <span class=\"n\">contain</span> <span class=\"n\">placeholders</span> <span class=\"n\">within</span> <span class=\"n\">curly</span> <span class=\"n\">braces</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prompt</span> <span class=\"o\">=</span> <span class=\"n\">prompt</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_pattern</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">compile</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s2\">&quot;\\{([^}]+)\\}&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">format_prompt</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">Formats</span> <span class=\"n\">the</span> <span class=\"n\">prompt</span> <span class=\"n\">string</span> <span class=\"n\">using</span> <span class=\"n\">the</span> <span class=\"n\">keyword</span> <span class=\"n\">arguments</span> <span class=\"n\">provided</span><span class=\"o\">.</span>\n\n        <span class=\"p\">:</span><span class=\"n\">param</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span> <span class=\"n\">The</span> <span class=\"n\">values</span> <span class=\"n\">to</span> <span class=\"n\">substitute</span> <span class=\"n\">into</span> <span class=\"n\">the</span> <span class=\"n\">prompt</span> <span class=\"n\">string</span>\n        <span class=\"p\">:</span><span class=\"k\">return</span><span class=\"p\">:</span> <span class=\"n\">The</span> <span class=\"n\">formatted</span> <span class=\"n\">prompt</span> <span class=\"n\">string</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">matches</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_pattern</span><span class=\"o\">.</span><span class=\"n\">findall</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"p\">{</span><span class=\"n\">match</span><span class=\"p\">:</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">,</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;</span><span class=\"s2\">) for match in matches})</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">get_input_variables</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">Gets</span> <span class=\"n\">the</span> <span class=\"nb\">list</span> <span class=\"n\">of</span> <span class=\"nb\">input</span> <span class=\"n\">variable</span> <span class=\"n\">names</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">the</span> <span class=\"n\">prompt</span> <span class=\"n\">string</span><span class=\"o\">.</span>\n\n        <span class=\"p\">:</span><span class=\"k\">return</span><span class=\"p\">:</span> <span class=\"n\">List</span> <span class=\"n\">of</span> <span class=\"nb\">input</span> <span class=\"n\">variable</span> <span class=\"n\">names</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_pattern</span><span class=\"o\">.</span><span class=\"n\">findall</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"p\">)</span>\n</code></pre></div>\n<span class=\"paragraph\">Then we have our <code>RolePrompt</code> which laser focuses us on the role pattern found in most API endpoints for LLMs.</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">RolePrompt</span><span class=\"p\">(</span><span class=\"n\">BasePrompt</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">prompt</span><span class=\"p\">,</span> <span class=\"n\">role</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">Initializes</span> <span class=\"n\">the</span> <span class=\"n\">RolePrompt</span> <span class=\"nb\">object</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">prompt</span> <span class=\"n\">template</span> <span class=\"ow\">and</span> <span class=\"n\">a</span> <span class=\"n\">role</span><span class=\"o\">.</span>\n\n        <span class=\"p\">:</span><span class=\"n\">param</span> <span class=\"n\">prompt</span><span class=\"p\">:</span> <span class=\"n\">A</span> <span class=\"n\">string</span> <span class=\"n\">that</span> <span class=\"n\">can</span> <span class=\"n\">contain</span> <span class=\"n\">placeholders</span> <span class=\"n\">within</span> <span class=\"n\">curly</span> <span class=\"n\">braces</span>\n        <span class=\"p\">:</span><span class=\"n\">param</span> <span class=\"n\">role</span><span class=\"p\">:</span> <span class=\"n\">The</span> <span class=\"n\">role</span> <span class=\"k\">for</span> <span class=\"n\">the</span> <span class=\"n\">message</span> <span class=\"p\">(</span><span class=\"s1\">&#39;system&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;user&#39;</span><span class=\"p\">,</span> <span class=\"ow\">or</span> <span class=\"s1\">&#39;assistant&#39;</span><span class=\"p\">)</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">prompt</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">role</span> <span class=\"o\">=</span> <span class=\"n\">role</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">create_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"n\">Creates</span> <span class=\"n\">a</span> <span class=\"n\">message</span> <span class=\"n\">dictionary</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">role</span> <span class=\"ow\">and</span> <span class=\"n\">a</span> <span class=\"n\">formatted</span> <span class=\"n\">message</span><span class=\"o\">.</span>\n\n        <span class=\"p\">:</span><span class=\"n\">param</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span> <span class=\"n\">The</span> <span class=\"n\">values</span> <span class=\"n\">to</span> <span class=\"n\">substitute</span> <span class=\"n\">into</span> <span class=\"n\">the</span> <span class=\"n\">prompt</span> <span class=\"n\">string</span>\n        <span class=\"p\">:</span><span class=\"k\">return</span><span class=\"p\">:</span> <span class=\"n\">Dictionary</span> <span class=\"n\">containing</span> <span class=\"n\">the</span> <span class=\"n\">role</span> <span class=\"ow\">and</span> <span class=\"n\">the</span> <span class=\"n\">formatted</span> <span class=\"n\">message</span>\n        \\<span class=\"s2\">&quot;</span><span class=\"se\">\\&quot;\\&quot;</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span><span class=\"s2\">&quot;role&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">role</span><span class=\"p\">,</span> <span class=\"s2\">&quot;content&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">format_prompt</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)}</span>\n</code></pre></div>\n<span class=\"paragraph\">We'll look at how the <code>SystemRolePrompt</code> is constructed to get a better idea of how that extension works:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">SystemRolePrompt</span><span class=\"p\">(</span><span class=\"n\">RolePrompt</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">prompt</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">prompt</span><span class=\"p\">,</span> <span class=\"s2\">&quot;system&quot;</span><span class=\"p\">)</span>\n</code></pre></div>\n<span class=\"paragraph\">That pattern is repeated for our <code>UserRolePrompt</code> and our <code>AssistantRolePrompt</code> as well.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "yCnT",
      "code_hash": "28f0913039834b3aa901327f0a6fc489",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"chatopenai\">ChatOpenAI</h5></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "wlCL",
      "code_hash": "47efbe4da074bd11167b7f223d72e230",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Next we have our model, which is converted to a format analogous to libraries like LangChain and LlamaIndex.</span>\n<span class=\"paragraph\">Let's take a peek at how that is constructed:</span>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ChatOpenAI</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model_name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;gpt-4.1-mini&quot;</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model_name</span> <span class=\"o\">=</span> <span class=\"n\">model_name</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">openai_api_key</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getenv</span><span class=\"p\">(</span><span class=\"s2\">&quot;OPENAI_API_KEY&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">openai_api_key</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;OPENAI_API_KEY is not set&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"p\">,</span> <span class=\"n\">text_only</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">messages</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;messages must be a list&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">openai</span><span class=\"o\">.</span><span class=\"n\">api_key</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">openai_api_key</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">openai</span><span class=\"o\">.</span><span class=\"n\">ChatCompletion</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n            <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">messages</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">text_only</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">choices</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"o\">.</span><span class=\"n\">content</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">response</span>\n</code></pre></div></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "kqZH",
      "code_hash": "b7eb23d780b31fda88b571a754ed6a3e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h4 id=\"question-3\">\u2753 Question #3:</h4>\n<span class=\"paragraph\">When calling the OpenAI API - are there any ways we can achieve more reproducible outputs?</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: Check out <a href=\"https://platform.openai.com/docs/guides/text-generation/\" rel=\"noopener noreferrer\" target=\"_blank\">this section</a> of the OpenAI documentation for the answer!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "wAgl",
      "code_hash": "66bd34e99dec88df50bbc4a6dde2fc57",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"answer-yes-we-can-submit-context-free-grammars-to-get-structured-outputs-or-we-can-let-them-do-the-structured-outputs-on-their-end-whatever-floats-your-boat-ig\">\u2705 Answer: Yes, we can submit context-free grammars to get structured outputs! Or we can let them do the structured outputs on their end, whatever floats your boat ig</h5></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "rEll",
      "code_hash": "45bfe57ed39de83eedad2d7d9bae3db4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"creating-and-prompting-openais-gpt-41-mini\">Creating and Prompting OpenAI's <code>gpt-4.1-mini</code>!</h3>\n<span class=\"paragraph\">Let's tie all these together and use it to prompt <code>gpt-4.1-mini</code>!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "lgWD",
      "code_hash": "87400ff16abf0f04e113aad6fed4fc6d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"task-5-retrieval-augmented-generation\">Task 5: Retrieval Augmented Generation</h2>\n<span class=\"paragraph\">Now we can create a RAG prompt - which will help our system behave in a way that makes sense!</span>\n<span class=\"paragraph\">There is much you could do here, many tweaks and improvements to be made!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "fwwy",
      "code_hash": "eb3bdb54e6f7f1d96a621f98830a9c5e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Now we can create our pipeline!</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "jxvo",
      "code_hash": "6c55efb2c42fd5c903f2fc2eca206d68",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h4 id=\"question-4\">\u2753 Question #4:</h4>\n<span class=\"paragraph\">What prompting strategies could you use to make the LLM have a more thoughtful, detailed response?</span>\n<span class=\"paragraph\">What is that strategy called?</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: You can look through our <a href=\"https://colab.research.google.com/drive/14SCfRnp39N7aoOx8ZxadWb0hAqk4lQdL?usp=sharing\" rel=\"noopener noreferrer\" target=\"_blank\">OpenAI Responses API</a> notebook for an answer to this question if you get stuck!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "mWxS",
      "code_hash": "b0e1b3a9b77fc253ca34e8e888691bfd",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h5 id=\"answer-cot-and-derivatives-my-fav-is-thread-of-thought-self-criticism-ensembling\">\u2705 Answer: CoT (and derivatives, my fav is Thread of Thought), self-criticism, ensembling,</h5></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "CcZR",
      "code_hash": "5cfb6f376bc9eb6965707f10dc3a7742",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"activity-1\">\ud83c\udfd7\ufe0f Activity #1:</h3>\n<span class=\"paragraph\">Enhance your Personal Wellness Assistant in some way!</span>\n<span class=\"paragraph\">Suggestions are:</span>\n<ul>\n<li><strong>PDF Support</strong>: Allow it to ingest wellness PDFs (meal plans, workout guides, medical information sheets)</li>\n<li><strong>New Distance Metric</strong>: Implement a different similarity measure - does it improve retrieval for health queries?</li>\n<li><strong>Metadata Support</strong>: Add metadata like topic categories (exercise, nutrition, sleep) or difficulty levels to help filter results</li>\n<li><strong>Different Embedding Model</strong>: Try a different embedding model - does domain-specific tuning help for health content?</li>\n<li><strong>Multi-Source Ingestion</strong>: Add the capability to ingest content from YouTube health videos, podcasts, or health blogs</li>\n</ul>\n<span class=\"paragraph\">While these are suggestions, you should feel free to make whatever augmentations you desire! Think about what features would make this wellness assistant most useful for your personal health journey.</span>\n<span class=\"paragraph\">When you're finished making the augments to your RAG application - vibe check it against the old one - see if you can \"feel the improvement\"!</span>\n<blockquote>\n<span class=\"paragraph\">NOTE: These additions might require you to work within the <code>aimakerspace</code> library - that's expected!</span>\n<span class=\"paragraph\">NOTE: If you're not sure where to start - ask Cursor (CMD/CTRL+L) to guide you through the changes!</span>\n</blockquote></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "9438963013a6b13d96b8ffdfa6920f10",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "6113c416d4d4d2395161cd4c6d666faf",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "35cb4fcc14ac15da850b03297afcc1b2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>1</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "8183fee2dd36a251f95d48a56ba668c5",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "The Personal Wellness Guide\nA Comprehensive Resource for Health and Well-being\n\nPART 1: EXERCISE AND\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Hstk",
      "code_hash": "1a4fd57f4c746bef9048ff625cfd582d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>21</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "iLit",
      "code_hash": "9cc5a954d175cff3500956d878b81003",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[\"The Personal Wellness Guide\\nA Comprehensive Resource for Health and Well-being\\n\\nPART 1: EXERCISE AND MOVEMENT\\n\\nChapter 1: Understanding Exercise Basics\\n\\nExercise is one of the most important things you can do for your health. Regular physical activity can improve your brain health, help manage weight, reduce the risk of disease, strengthen bones and muscles, and improve your ability to do everyday activities.\\n\\nThe four main types of exercise are aerobic (cardio), strength training, flexibility, and balance exercises. A well-rounded fitness routine includes all four types. Adults should aim for at least 150 minutes of moderate-intensity aerobic activity per week, along with muscle-strengthening activities on 2 or more days per week.\\n\\nChapter 2: Exercises for Common Problems\\n\\nLower Back Pain Relief\\nLower back pain affects approximately 80% of adults at some point in their lives. Gentle stretching and strengthening exercises can help alleviate discomfort and prevent future episodes.\\n\\nReco\"]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "qnkX",
      "code_hash": "8612e9f652842a3d67329a2a7593e4f6",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "/home/imjonezz/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/getpass.py:62: GetPassWarning: Can not control echo on the terminal.\n  passwd = fallback_getpass(prompt, stream)\nWarning: Password input may be echoed.\nOpenAI API Key: ",
          "mimetype": "text/plain"
        },
        {
          "type": "stream",
          "name": "stdout",
          "text": " aSDF\n",
          "mimetype": "text/plain"
        },
        {
          "type": "stream",
          "name": "stderr",
          "text": "\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "ZBYS",
      "code_hash": "8172c444d4bc37119e18834f8b6f069a",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "pHFh",
      "code_hash": "94a3339837764a6fd2fdd96ecd985f8b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[[\" Relief\\nLower back pain affects approximately 80% of adults at some point in their lives. Gentle stretching and strengthening exercises can help alleviate discomfort and prevent future episodes.\\n\\nRecommended exercises for lower back pain include:\\n- Cat-Cow Stretch: Start on hands and knees, alternate between arching your back up (cat) and letting it sag down (cow). Do 10-15 repetitions.\\n- Bird Dog: From hands and knees, extend opposite arm and leg while keeping your core engaged. Hold for 5 seconds, then switch sides. Do 10 repetitions per side.\\n- Partial Crunches: Lie on your back with knees bent, cross arms over chest, tighten stomach muscles and raise shoulders off floor. Hold briefly, then lower. Do 8-12 repetitions.\\n- Knee-to-Chest Stretch: Lie on your back, pull one knee toward your chest while keeping the other foot flat. Hold for 15-30 seconds, then switch legs.\\n- Pelvic Tilts: Lie on your back with knees bent, flatten your back against the floor by tightening abs and tilting p\", \"text/plain+float:0.7510530552519835\"], [\"The Personal Wellness Guide\\nA Comprehensive Resource for Health and Well-being\\n\\nPART 1: EXERCISE AND MOVEMENT\\n\\nChapter 1: Understanding Exercise Basics\\n\\nExercise is one of the most important things you can do for your health. Regular physical activity can improve your brain health, help manage weight, reduce the risk of disease, strengthen bones and muscles, and improve your ability to do everyday activities.\\n\\nThe four main types of exercise are aerobic (cardio), strength training, flexibility, and balance exercises. A well-rounded fitness routine includes all four types. Adults should aim for at least 150 minutes of moderate-intensity aerobic activity per week, along with muscle-strengthening activities on 2 or more days per week.\\n\\nChapter 2: Exercises for Common Problems\\n\\nLower Back Pain Relief\\nLower back pain affects approximately 80% of adults at some point in their lives. Gentle stretching and strengthening exercises can help alleviate discomfort and prevent future episodes.\\n\\nReco\", \"text/plain+float:0.4883259313072032\"], [\"chest while keeping the other foot flat. Hold for 15-30 seconds, then switch legs.\\n- Pelvic Tilts: Lie on your back with knees bent, flatten your back against the floor by tightening abs and tilting pelvis up slightly. Hold for 10 seconds, repeat 8-12 times.\\n\\nNeck and Shoulder Tension\\nDesk work and poor posture often lead to neck and shoulder tension. These exercises can provide relief:\\n- Neck Rolls: Slowly roll your head in a circle, 5 times in each direction.\\n- Shoulder Shrugs: Raise shoulders toward ears, hold for 5 seconds, then release. Repeat 10 times.\\n- Chest Opener: Clasp hands behind back, squeeze shoulder blades together, and lift arms slightly. Hold for 15-30 seconds.\\n- Chin Tucks: While sitting or standing tall, pull your chin back to create a \\\"double chin.\\\" Hold for 5 seconds, repeat 10 times.\\n\\nChapter 3: Building a Workout Routine\\n\\nStarting a new exercise routine can feel overwhelming. The key is to start slowly and gradually increase intensity and duration over time.\\n\\nBe\", \"text/plain+float:0.4654981355258454\"]]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "dGlV",
      "code_hash": "bae3e67fa683d4484babdb9aa275ceab",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "SdmI",
      "code_hash": "07fabe2f5d580c672f857f93419899c0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "**Hey there! \ud83d\udc4b**  \nWriting loops is something every Python programmer does all the time, and there are a few \u201cPythonic\u201d habits that make them easier to read, safer to run, and often faster too. Below is a quick guide covering the most common loop patterns, best\u2011practice tips, and handy examples you can copy\u2011paste into your own code.\n\n---\n\n## 1\ufe0f\u20e3 Choose the right kind of loop\n\n| Situation | Preferred construct |\n|-----------|---------------------|\n| You have an **iterable** (list, tuple, dict, generator, file, \u2026) that you want to walk through once \u2192 `for` loop. |\n| You need to repeat *until a condition* that isn\u2019t tied to an iterable (e.g., keep prompting until the user types \u201cquit\u201d) \u2192 `while` loop. |\n| You can express the whole operation with a **built\u2011in function** (`sum`, `any`, `all`, `max`, \u2026) or a **comprehension** \u2192 use that instead of an explicit loop (it\u2019s usually clearer and faster). |\n\n> **Rule of thumb:** *If you can write it as \u201cfor item in iterable\u201d, do so.*  `while` loops are more error\u2011prone because you have to manage the termination condition yourself.\n\n---\n\n## 2\ufe0f\u20e3 The classic `for` loop \u2013 keep it simple\n\n```python\n# Iterate over a list and print each element\nfruits = [\"apple\", \"banana\", \"cherry\"]\nfor fruit in fruits:\n    print(fruit)\n```\n\n### When you need the index, **don\u2019t** use `range(len(...))`. Use `enumerate`:\n\n```python\n# Safer & more readable than: for i in range(len(fruits)):\nfor i, fruit in enumerate(fruits):\n    print(i, fruit)          # 0 apple, 1 banana, \u2026\n```\n\n### Looping over *multiple* iterables \u2192 `zip` (or `itertools.zip_longest` if lengths differ)\n\n```python\nnames = [\"Alice\", \"Bob\", \"Cathy\"]\nages  = [25,      30,   22]\n\nfor name, age in zip(names, ages):\n    print(f\"{name} is {age} years old\")\n```\n\n---\n\n## 3\ufe0f\u20e3 List comprehensions & generator expressions \u2013 the \u201cone\u2011liner\u201d power tools\n\n| Use case | Preferred syntax |\n|----------|------------------|\n| Build a **new list** from an existing iterable \u2192 *list comprehension* (`[expr for item in seq if cond]`). |\n| Compute something **on the fly** without storing all intermediate results \u2192 *generator expression* (`(expr for item in seq if cond)`). |\n\n### Examples\n\n```python\n# List of squares (creates a list)\nsquares = [x*x for x in range(10)]\n\n# Sum of squares (no temporary list!)\ntotal = sum(x*x for x in range(10))\n\n# Filter & transform strings\nupper_vowels = [c.upper() for c in \"abracadabra\" if c in \"aeiou\"]\n```\n\n**Why they\u2019re nice:**  \n* They\u2019re usually **faster** than a manual `for` loop because the interpreter can optimize them.  \n* They keep the *what* (the transformation) separate from the *how* (iteration), which improves readability.\n\n---\n\n## 4\ufe0f\u20e3 When you need more control: `while` loops\n\n```python\n# Keep asking until the user types \"quit\"\nwhile True:\n    cmd = input(\"Enter command (or 'quit'): \").strip()\n    if cmd.lower() == \"quit\":\n        break          # exit loop early\n    print(f\"You typed {cmd}\")\n```\n\n**Tips for safe `while` loops**\n\n1. **Always have a clear termination condition** \u2013 otherwise you get an infinite loop.\n2. If the loop is based on a counter, prefer `for i in range(n)` unless the bound changes dynamically.\n3. Use `else` on a loop only when it adds real value (e.g., \u201cdidn\u2019t break\u201d logic). Most codebases avoid it because it can be confusing.\n\n```python\n# Example of a loop\u2011else: search for an item, report if not found\nfor i, val in enumerate(my_list):\n    if val == target:\n        print(f\"Found at index {i}\")\n        break\nelse:               # runs only if we never hit `break`\n    print(\"Target not present\")\n```\n\n---\n\n## 5\ufe0f\u20e3 Avoid common pitfalls\n\n| Pitfall | How to avoid it |\n|---------|-----------------|\n| **Modifying a list while iterating over it** (`for x in lst: lst.append(x)`) | Iterate over a *copy* (`for x in lst[:]`), or build a new list with a comprehension. |\n| **Off\u2011by\u2011one errors** (`range(len(seq)-1)` vs `range(len(seq))`) | Use `enumerate`, slicing, or direct iteration instead of manual index math. |\n| **Unnecessary temporary lists** (e.g., `list(map(...))` when you only need to iterate) | Prefer generator expressions or `itertools`. |\n| **Deeply nested loops with many statements** | Extract the inner logic into a helper function \u2013 keeps each loop body short and readable. |\n\n---\n\n## 6\ufe0f\u20e3 Advanced iteration helpers (`itertools`)\n\nIf you find yourself writing \u201cmanual\u201d loops for things like chunking, cycling, or flattening, the `itertools` module has battle\u2011tested tools:\n\n```python\nimport itertools\n\n# Iterate over pairs (a, b) where a comes from seq1 and b from seq2,\n# but stop when the shorter sequence ends.\nfor a, b in zip(seq1, seq2):\n    ...\n\n# Infinite cycle through a list\nfor item in itertools.cycle(['red', 'green', 'blue']):\n    ...\n\n# Take first 5 items of an infinite generator\nfirst_five = list(itertools.islice(itertools.count(), 5))\n```\n\n---\n\n## 7\ufe0f\u20e3 Quick checklist for \u201cPythonic\u201d loops\n\n- **[ ]** Use `for \u2026 in iterable` whenever possible.  \n- **[ ]** Prefer built\u2011ins (`sum`, `any`, `all`, `max`) over explicit loops for simple aggregations.  \n- **[ ]** Use `enumerate` instead of `range(len(...))`.  \n- **[ ]** Use `zip` (or `itertools.zip_longest`) for parallel iteration.  \n- **[ ]** Write list comprehensions / generator expressions for short, pure\u2011transform loops.  \n- **[ ]** Keep the loop body *simple*: if it grows beyond ~3\u20134 lines, consider moving logic to a helper function.  \n- **[ ]** Avoid mutating the sequence you\u2019re iterating over; iterate over a copy or build a new collection.  \n- **[ ]** Ensure termination conditions are obvious (especially for `while`).  \n\n---\n\n## 8\ufe0f\u20e3 A \u201creal\u2011world\u201d example tying everything together\n\nSuppose we have a CSV file with rows `\"name,score\"` and we want to:\n\n1. Read it line\u2011by\u2011line.  \n2. Keep only rows where the score \u2265\u202f70.  \n3. Produce a list of `(name, score)` tuples sorted by descending score.\n\n```python\nimport csv\n\ndef high_scorers(csv_path, cutoff=70):\n    \"\"\"Return a sorted list of (name, int(score)) for scores >= cutoff.\"\"\"\n    with open(csv_path, newline='') as f:\n        reader = csv.reader(f)\n        # 1\ufe0f\u20e3 generator expression \u2192 filters while reading (no full list in memory)\n        filtered = ((row[0], int(row[1]))\n                    for row in reader\n                    if int(row[1]) >= cutoff)\n\n    # 2\ufe0f\u20e3 Convert to a list and sort \u2013 small enough that materialising is fine.\n    return sorted(filtered, key=lambda pair: pair[1], reverse=True)\n\n\n# Usage\ntop = high_scorers('grades.csv')\nfor name, score in top:\n    print(f\"{name}: {score}\")\n```\n\n*What we demonstrated:*  \n- **`with open(...) as f:`** ensures the file is closed automatically.  \n- A **generator expression** does the filtering on\u2011the\u2011fly (memory\u2011efficient).  \n- `sorted(..., key=..., reverse=True)` replaces a manual loop + `list.sort()` for clarity.\n\n---\n\n## \ud83c\udf89 Wrap\u2011up\n\nLoops are the workhorse of any program, but in Python we have many shortcuts that make them **shorter**, **clearer**, and often **faster**. The \u201cbest\u201d way is usually the one that:\n\n1. Expresses *what* you want to do at a glance (readability).  \n2. Uses built\u2011ins or comprehensions when they fit.  \n3. Keeps edge cases (off\u2011by\u2011one, infinite loops, mutating while iterating) out of the picture.\n\nGive these patterns a try in your next script\u2014once you get into the habit of \u201cPythonic\u201d looping, your code will read almost like plain English! If you have a specific scenario you\u2019re wrestling with, feel free to share it and I can tailor an example just for you. Happy coding! \ud83d\ude80\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "yOPj",
      "code_hash": "0992db62f4d82f6ae6773f38e8120e4a",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "LJZf",
      "code_hash": "da230d41cbdf0ad3d0815463f3f6b5f4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "urSm",
      "code_hash": "98a58047ad22428ca14f4f3065e1ef12",
      "outputs": [],
      "console": []
    },
    {
      "id": "YWSi",
      "code_hash": "ce6b064d3a0b5317d17aadaa09f285b1",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "Directory 'static/' does not exist",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/tmp/marimo_615354/__marimo__cell_YWSi_.py&quot;</span>, line <span class=\"m\">2</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">aimakerspace.pdf_utils</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">PDFIngestionPipeline</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/02_Dense_Vector_Retrieval/aimakerspace/pdf_utils.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">fitz</span>  <span class=\"c1\"># PyMuPDF</span>\n<span class=\"w\">    </span><span class=\"pm\">^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/fitz/__init__.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">frontend</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"o\">*</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/__init__.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">.events</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"o\">*</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/events/__init__.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">.clipboard</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"o\">*</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/events/clipboard.py&quot;</span>, line <span class=\"m\">2</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">..dom</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Event</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/dom.py&quot;</span>, line <span class=\"m\">439</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">.</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">dispatcher</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/dispatcher.py&quot;</span>, line <span class=\"m\">15</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">.</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">config</span><span class=\"p\">,</span> <span class=\"n\">server</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/frontend/server.py&quot;</span>, line <span class=\"m\">24</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">mount</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">STATIC_ROUTE</span><span class=\"p\">,</span> <span class=\"n\">StaticFiles</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">STATIC_DIRECTORY</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">STATIC_NAME</span><span class=\"p\">)</span>\n<span class=\"w\">                                   </span><span class=\"pm\">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/home/imjonezz/Desktop/AIE9/03_The_Agent_Loop/.venv/lib/python3.12/site-packages/starlette/staticfiles.py&quot;</span>, line <span class=\"m\">56</span>, in <span class=\"n\">__init__</span>\n<span class=\"w\">    </span><span class=\"k\">raise</span> <span class=\"ne\">RuntimeError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Directory &#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s2\">&#39; does not exist&quot;</span><span class=\"p\">)</span>\n<span class=\"gr\">RuntimeError</span>: <span class=\"n\">Directory &#39;static/&#39; does not exist</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "zlud",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [],
      "console": []
    }
  ]
}